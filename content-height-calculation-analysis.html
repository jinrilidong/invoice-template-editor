<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>内容总高度计算分析</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .analysis-container {
            max-width: 900px;
            margin: 0 auto;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .calculation-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .calculation-value {
            font-weight: bold;
            color: #2563eb;
        }
        .calculation-box {
            background-color: #fef3c7;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .code-block {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border-left: 4px solid #2563eb;
        }
        .highlight {
            background-color: #fef3c7;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .formula {
            background-color: #e0f2fe;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #0288d1;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .table th, .table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="analysis-container">
        <h1>内容总高度计算分析</h1>
        
        <div class="section">
            <div class="section-title">🔍 内容高度计算的两个主要函数</div>
            
            <h3>1. getAllContentElements() - 精确计算</h3>
            <p>这个函数将内容分解为独立的元素，每个元素都有明确的高度值：</p>
            
            <div class="code-block">
const getAllContentElements = () => {
  const elements = []
  
  // Header Section
  if (props.sectionStates.header) {
    elements.push({
      type: 'header',
      height: 48,  // 固定48px
      content: 'header'
    })
  }
  
  // Info Section
  if (props.sectionStates.info && props.templateData.info?.items) {
    elements.push({
      type: 'info',
      height: props.templateData.info.items.length * 20,  // 每个item 20px
      content: 'info'
    })
  }
  
  // Table Section
  if (props.sectionStates.table && props.templateData.tables?.length > 0) {
    const table = props.templateData.tables[0]
    const allRows = getTableRows(table)
    
    // 表格头部
    elements.push({
      type: 'table-header',
      height: 40,  // 固定40px
      content: 'table-header'
    })
    
    // 每一行
    allRows.forEach((row, index) => {
      elements.push({
        type: 'table-row',
        height: 15,  // 每行15px
        content: row,
        rowIndex: index
      })
    })
  }
  
  // Description Section
  if (props.sectionStates.description && props.templateData.description?.content) {
    const contentLength = props.templateData.description.content.length
    elements.push({
      type: 'description',
      height: Math.ceil(contentLength / 100) * 20,  // 每100字符20px
      content: 'description'
    })
  }
  
  // Item Section
  if (props.sectionStates.item && props.templateData.item?.items) {
    elements.push({
      type: 'item',
      height: props.templateData.item.items.length * 20,  // 每个item 20px
      content: 'item'
    })
  }
  
  return elements
}
            </div>

            <h3>2. getEstimatedHeight() - 估算计算</h3>
            <p>这个函数提供快速的高度估算，用于性能优化：</p>
            
            <div class="code-block">
const getEstimatedHeight = () => {
  let estimatedHeight = 0
  
  // Header section height (approximately 48px)
  if (props.sectionStates.header) {
    estimatedHeight += 48
  }
  
  // Info section height (approximately 20px per item)
  if (props.sectionStates.info && props.templateData.info?.items) {
    estimatedHeight += props.templateData.info.items.length * 20
  }
  
  // Table section height (approximately 15px per row)
  if (props.sectionStates.table && props.templateData.tables?.length > 0) {
    props.templateData.tables.forEach((table) => {
      const rowsCount = getTableRows(table).length
      estimatedHeight += 40 + (rowsCount * 15)  // 40px for header + 15px per row
    })
  }
  
  // Description section height (approximately 20px per 100 characters)
  if (props.sectionStates.description && props.templateData.description?.content) {
    const contentLength = props.templateData.description.content.length
    estimatedHeight += Math.ceil(contentLength / 100) * 20
  }
  
  // Item section height (approximately 20px per item)
  if (props.sectionStates.item && props.templateData.item?.items) {
    estimatedHeight += props.templateData.item.items.length * 20
  }
  
  // Footer section height (approximately 30px)
  if (props.sectionStates.footer) {
    estimatedHeight += 30
  }
  
  // Add padding and margins (approximately 100px)
  estimatedHeight += 100
  
  return estimatedHeight
}
            </div>
        </div>

        <div class="section">
            <div class="section-title">📊 各Section高度计算规则</div>
            
            <table class="table">
                <tr>
                    <th>Section类型</th>
                    <th>高度计算规则</th>
                    <th>示例</th>
                    <th>说明</th>
                </tr>
                <tr>
                    <td>Header Section</td>
                    <td>固定 48px</td>
                    <td>48px</td>
                    <td>h-12 = 3rem = 48px</td>
                </tr>
                <tr>
                    <td>Info Section</td>
                    <td>items数量 × 20px</td>
                    <td>3个items = 60px</td>
                    <td>每个info item约20px高度</td>
                </tr>
                <tr>
                    <td>Table Section</td>
                    <td>40px + (行数 × 15px)</td>
                    <td>5行 = 40 + 75 = 115px</td>
                    <td>表头40px + 每行15px</td>
                </tr>
                <tr>
                    <td>Description Section</td>
                    <td>Math.ceil(字符数/100) × 20px</td>
                    <td>250字符 = 3 × 20 = 60px</td>
                    <td>每100字符约20px高度</td>
                </tr>
                <tr>
                    <td>Item Section</td>
                    <td>items数量 × 20px</td>
                    <td>2个items = 40px</td>
                    <td>每个item约20px高度</td>
                </tr>
                <tr>
                    <td>Footer Section</td>
                    <td>固定 30px (估算)</td>
                    <td>30px</td>
                    <td>h-2.25 = 9px，但估算为30px</td>
                </tr>
            </table>
        </div>

        <div class="section">
            <div class="section-title">🧮 实际计算示例</div>
            
            <div class="calculation-box">
                <h4>假设内容配置：</h4>
                <ul>
                    <li>Header: 启用</li>
                    <li>Info: 3个items</li>
                    <li>Table: 1个table，5行数据</li>
                    <li>Description: 250字符内容</li>
                    <li>Item: 2个items</li>
                    <li>Footer: 启用</li>
                </ul>
                
                <h4>getAllContentElements() 精确计算：</h4>
                <div class="calculation-item">
                    <span>Header元素:</span>
                    <span class="calculation-value">48px</span>
                </div>
                <div class="calculation-item">
                    <span>Info元素 (3 × 20px):</span>
                    <span class="calculation-value">60px</span>
                </div>
                <div class="calculation-item">
                    <span>Table Header元素:</span>
                    <span class="calculation-value">40px</span>
                </div>
                <div class="calculation-item">
                    <span>Table Row元素 (5 × 15px):</span>
                    <span class="calculation-value">75px</span>
                </div>
                <div class="calculation-item">
                    <span>Description元素 (Math.ceil(250/100) × 20px):</span>
                    <span class="calculation-value">60px</span>
                </div>
                <div class="calculation-item">
                    <span>Item元素 (2 × 20px):</span>
                    <span class="calculation-value">40px</span>
                </div>
                <div class="calculation-item">
                    <span><strong>总高度 (getAllContentElements):</strong></span>
                    <span class="calculation-value"><strong>323px</strong></span>
                </div>
                
                <h4>getEstimatedHeight() 估算计算：</h4>
                <div class="calculation-item">
                    <span>Header (48px):</span>
                    <span class="calculation-value">48px</span>
                </div>
                <div class="calculation-item">
                    <span>Info (3 × 20px):</span>
                    <span class="calculation-value">60px</span>
                </div>
                <div class="calculation-item">
                    <span>Table (40px + 5 × 15px):</span>
                    <span class="calculation-value">115px</span>
                </div>
                <div class="calculation-item">
                    <span>Description (Math.ceil(250/100) × 20px):</span>
                    <span class="calculation-value">60px</span>
                </div>
                <div class="calculation-item">
                    <span>Item (2 × 20px):</span>
                    <span class="calculation-value">40px</span>
                </div>
                <div class="calculation-item">
                    <span>Footer (30px):</span>
                    <span class="calculation-value">30px</span>
                </div>
                <div class="calculation-item">
                    <span>Padding和Margins (100px):</span>
                    <span class="calculation-value">100px</span>
                </div>
                <div class="calculation-item">
                    <span><strong>总高度 (getEstimatedHeight):</strong></span>
                    <span class="calculation-value"><strong>453px</strong></span>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">⚙️ 分页计算逻辑</div>
            
            <div class="formula">
                <h4>分页条件：</h4>
                <p><strong>当内容高度 > (内容区域高度 - Footer高度 - 底边距要求) 时触发分页</strong></p>
                <p>即：<span class="highlight">内容高度 > 723px - 9px - 10px = 704px</span></p>
            </div>
            
            <div class="code-block">
// 分页计算逻辑
const maxHeightPerPage = 723  // 内容区域高度
const bottomMargin = 10       // 底边距要求
const footerHeight = 9        // Footer高度

// 检查是否需要分页
const remainingHeight = maxHeightPerPage - footerHeight - currentHeight - element.height
if (currentHeight + element.height > maxHeightPerPage - footerHeight || remainingHeight < bottomMargin) {
  // 触发分页
  pages++
  currentPageHeight = element.height
}
            </div>
        </div>

        <div class="section">
            <div class="section-title">🎯 关键发现</div>
            
            <div class="calculation-box">
                <h4>两种计算方法的区别：</h4>
                <ul>
                    <li><strong>getAllContentElements():</strong> 精确计算，用于分页逻辑</li>
                    <li><strong>getEstimatedHeight():</strong> 快速估算，包含额外的padding/margin</li>
                    <li><strong>分页使用:</strong> getAllContentElements() 的精确计算</li>
                    <li><strong>性能优化:</strong> getEstimatedHeight() 用于快速预判</li>
                </ul>
                
                <h4>高度计算特点：</h4>
                <ul>
                    <li>Table Section被分解为多个独立元素（header + rows）</li>
                    <li>Description Section根据字符数动态计算高度</li>
                    <li>Info和Item Section根据数量动态计算高度</li>
                    <li>Header Section使用固定高度</li>
                    <li>所有计算都考虑了实际的内容数据</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>









