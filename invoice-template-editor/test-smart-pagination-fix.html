<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½åˆ†é¡µä¿®å¤æµ‹è¯• - å†…å®¹æº¢å‡ºå’Œé‡å¤é—®é¢˜</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .test-steps {
            margin: 10px 0;
        }
        .test-step {
            margin: 5px 0;
            padding: 5px;
            background-color: #f5f5f5;
            border-radius: 3px;
        }
        .expected-result {
            color: #0066cc;
            font-weight: bold;
        }
        .debug-info {
            background-color: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .fix-details {
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .bug-fix {
            background-color: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .code-block {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>æ™ºèƒ½åˆ†é¡µä¿®å¤æµ‹è¯• - å†…å®¹æº¢å‡ºå’Œé‡å¤é—®é¢˜</h1>
        
        <div class="bug-fix">
            <h2>ğŸ› ä¿®å¤çš„é—®é¢˜</h2>
            <ul>
                <li><strong>é—®é¢˜1</strong>ï¼šå½“å†…å®¹é«˜åº¦è¶…è¿‡700pxæ—¶ï¼Œé¡µé¢å†…å®¹æº¢å‡º700pxå¤–é¢</li>
                <li><strong>é—®é¢˜2</strong>ï¼šç¬¬äºŒé¡µæ˜¾ç¤ºçš„å†…å®¹æ˜¯å¤åˆ¶ç¬¬ä¸€é¡µçš„table sectionå’ŒItem sectionè¿˜æœ‰Description</li>
                <li><strong>é—®é¢˜3</strong>ï¼šç¬¬äºŒé¡µåº”è¯¥æ˜¾ç¤ºç¬¬ä¸€é¡µè¶…è¿‡700pxé«˜åº¦ä»¥å¤–çš„å†…å®¹ï¼Œè€Œä¸æ˜¯é‡å¤å†…å®¹</li>
            </ul>
        </div>

        <div class="fix-details">
            <h2>ğŸ”§ ä¿®å¤æ–¹æ¡ˆ</h2>
            
            <h3>1. æ™ºèƒ½å†…å®¹åˆ†é…</h3>
            <div class="code-block">
// è®¡ç®—æ¯é¡µåº”è¯¥æ˜¾ç¤ºçš„å†…å®¹
const getPageContent = (pageIndex: number) => {
  const maxHeightPerPage = 700
  let currentHeight = 0
  const pageContent = {
    header: false,
    info: false,
    table: { show: false, rowsToShow: 0 },
    description: false,
    item: false,
    footer: false
  }
  
  // ç¬¬ä¸€é¡µæ€»æ˜¯æ˜¾ç¤ºheader
  if (pageIndex === 1 && props.sectionStates.header) {
    pageContent.header = true
    currentHeight += 48
  }
  
  // è®¡ç®—tableåº”è¯¥æ˜¾ç¤ºå¤šå°‘è¡Œ
  if (props.sectionStates.table) {
    const availableHeight = maxHeightPerPage - currentHeight - 100
    const maxRowsForThisPage = Math.max(0, Math.floor((availableHeight - 40) / 15))
    
    if (maxRowsForThisPage > 0) {
      pageContent.table.show = true
      pageContent.table.rowsToShow = Math.min(maxRowsForThisPage, totalRows)
    }
  }
  
  return pageContent
}
            </div>
            
            <h3>2. è¡¨æ ¼è¡Œåˆ†é¡µ</h3>
            <div class="code-block">
// è·å–å½“å‰é¡µé¢åº”è¯¥æ˜¾ç¤ºçš„è¡¨æ ¼è¡Œæ•°
const getTableRowsForPage = (table: any, pageIndex: number) => {
  const pageContent = getPageContent(pageIndex)
  if (!pageContent.table.show) return []
  
  const allRows = getTableRows(table)
  const rowsToShow = pageContent.table.rowsToShow
  
  // è®¡ç®—ä»å“ªä¸€è¡Œå¼€å§‹æ˜¾ç¤º
  let startIndex = 0
  for (let i = 1; i < pageIndex; i++) {
    const prevPageContent = getPageContent(i)
    if (prevPageContent.table.show) {
      startIndex += prevPageContent.table.rowsToShow
    }
  }
  
  return allRows.slice(startIndex, startIndex + rowsToShow)
}
            </div>
            
            <h3>3. ç²¾ç¡®åˆ†é¡µè®¡ç®—</h3>
            <div class="code-block">
// é‡æ–°è®¾è®¡åˆ†é¡µè®¡ç®—é€»è¾‘
const totalPages = computed(() => {
  const maxHeightPerPage = 700
  let totalHeight = 0
  
  // è®¡ç®—å„éƒ¨åˆ†é«˜åº¦
  if (props.sectionStates.header) totalHeight += 48
  if (props.sectionStates.info) totalHeight += items.length * 20
  if (props.sectionStates.table) totalHeight += 40 + (totalRows * 15)
  // ... å…¶ä»–éƒ¨åˆ†
  
  const pages = Math.ceil(totalHeight / maxHeightPerPage)
  return Math.max(1, pages)
})
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•åœºæ™¯ 1: å†…å®¹æº¢å‡ºä¿®å¤</div>
            <div class="test-steps">
                <div class="test-step">1. æ‰“å¼€åº”ç”¨ç¨‹åº (http://localhost:5174/)</div>
                <div class="test-step">2. è®¾ç½® Table Rows Number ä¸º 30</div>
                <div class="test-step">3. è§‚å¯Ÿç¬¬ä¸€é¡µçš„å†…å®¹</div>
                <div class="test-step">4. æ£€æŸ¥ç¬¬ä¸€é¡µå†…å®¹æ˜¯å¦è¶…è¿‡700pxé«˜åº¦</div>
                <div class="test-step">5. éªŒè¯ç¬¬ä¸€é¡µå†…å®¹æ˜¯å¦è¢«æ­£ç¡®æˆªæ–­</div>
            </div>
            <div class="expected-result">é¢„æœŸç»“æœ: 
                <ul>
                    <li>ç¬¬ä¸€é¡µå†…å®¹åº”è¯¥è¢«é™åˆ¶åœ¨700pxä»¥å†…</li>
                    <li>ç¬¬ä¸€é¡µä¸åº”è¯¥æ˜¾ç¤ºæ‰€æœ‰30è¡Œæ•°æ®</li>
                    <li>ç¬¬ä¸€é¡µåº”è¯¥æ˜¾ç¤ºheaderã€infoå’Œéƒ¨åˆ†tableè¡Œ</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•åœºæ™¯ 2: é‡å¤å†…å®¹ä¿®å¤</div>
            <div class="test-steps">
                <div class="test-step">1. è®¾ç½® Table Rows Number ä¸º 25</div>
                <div class="test-step">2. è§‚å¯Ÿç¬¬äºŒé¡µçš„å†…å®¹</div>
                <div class="test-step">3. æ£€æŸ¥ç¬¬äºŒé¡µæ˜¯å¦æ˜¾ç¤ºé‡å¤çš„tableè¡Œ</div>
                <div class="test-step">4. éªŒè¯ç¬¬äºŒé¡µæ˜¾ç¤ºçš„æ˜¯ç¬¬ä¸€é¡µæº¢å‡ºçš„å†…å®¹</div>
                <div class="test-step">5. æ£€æŸ¥ç¬¬äºŒé¡µçš„tableè¡Œæ˜¯å¦ä»ç¬¬ä¸€é¡µç»“æŸçš„åœ°æ–¹å¼€å§‹</div>
            </div>
            <div class="expected-result">é¢„æœŸç»“æœ: 
                <ul>
                    <li>ç¬¬äºŒé¡µä¸åº”è¯¥æ˜¾ç¤ºé‡å¤çš„tableè¡Œ</li>
                    <li>ç¬¬äºŒé¡µåº”è¯¥æ˜¾ç¤ºç¬¬ä¸€é¡µæº¢å‡ºçš„tableè¡Œ</li>
                    <li>ç¬¬äºŒé¡µçš„tableè¡Œåº”è¯¥ä»ç¬¬ä¸€é¡µç»“æŸçš„åœ°æ–¹å¼€å§‹</li>
                    <li>ç¬¬äºŒé¡µå¯èƒ½è¿˜åŒ…å«descriptionã€itemå’Œfooter</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•åœºæ™¯ 3: æ™ºèƒ½åˆ†é¡µéªŒè¯</div>
            <div class="test-steps">
                <div class="test-step">1. è®¾ç½® Table Rows Number ä¸º 50</div>
                <div class="test-step">2. è§‚å¯Ÿå¤šé¡µçš„å†…å®¹åˆ†å¸ƒ</div>
                <div class="test-step">3. æ£€æŸ¥æ¯é¡µçš„å†…å®¹æ˜¯å¦åˆç†åˆ†é…</div>
                <div class="test-step">4. éªŒè¯æ¯é¡µçš„å†…å®¹é«˜åº¦æ˜¯å¦æ¥è¿‘700px</div>
                <div class="test-step">5. æ£€æŸ¥æœ€åä¸€é¡µæ˜¯å¦åŒ…å«footer</div>
            </div>
            <div class="expected-result">é¢„æœŸç»“æœ: 
                <ul>
                    <li>åº”è¯¥æ˜¾ç¤º3-4é¡µ</li>
                    <li>æ¯é¡µå†…å®¹åº”è¯¥åˆç†åˆ†é…</li>
                    <li>æ¯é¡µå†…å®¹é«˜åº¦åº”è¯¥æ¥è¿‘700px</li>
                    <li>æœ€åä¸€é¡µåº”è¯¥åŒ…å«footer</li>
                    <li>tableè¡Œåº”è¯¥è¿ç»­åˆ†å¸ƒåœ¨å¤šé¡µä¸­</li>
                </ul>
            </div>
        </div>

        <div class="debug-info">
            <h3>ğŸ› è°ƒè¯•ä¿¡æ¯æ£€æŸ¥</h3>
            <p>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Console æ ‡ç­¾ï¼Œåº”è¯¥çœ‹åˆ°ï¼š</p>
            
            <h4>1. åˆ†é¡µè®¡ç®—ä¿¡æ¯</h4>
            <div class="code-block">
PdfPreviewPanel: Total pages calculation {
  totalHeight: 1200,        // æ€»å†…å®¹é«˜åº¦
  maxHeightPerPage: 700,    // æ¯é¡µæœ€å¤§é«˜åº¦
  calculatedPages: 2,       // è®¡ç®—çš„é¡µæ•°
  sections: {               // å„éƒ¨åˆ†çŠ¶æ€
    header: true,
    info: true,
    table: true,
    description: true,
    item: true,
    footer: true
  }
}
            </div>
            
            <h4>2. è¡¨æ ¼æ•°æ®æ›´æ–°</h4>
            <div class="code-block">
PdfPreviewPanel: table data updated [{
  id: "table-1",
  rowsNumber: 25,           // è®¾ç½®çš„è¡Œæ•°
  baseRowsCount: 5,         // åŸºç¡€è¡Œæ•°
  actualRowsToShow: 25      // å®é™…æ˜¾ç¤ºçš„è¡Œæ•°
}]
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•åœºæ™¯ 4: è¾¹ç•Œæƒ…å†µæµ‹è¯•</div>
            <div class="test-steps">
                <div class="test-step">1. æµ‹è¯•å°‘é‡å†…å®¹ (Rows = 5)</div>
                <div class="test-step">2. æµ‹è¯•ä¸´ç•Œå†…å®¹ (Rows = 15)</div>
                <div class="test-step">3. æµ‹è¯•å¤§é‡å†…å®¹ (Rows = 50)</div>
                <div class="test-step">4. æµ‹è¯•è¶…å¤§é‡å†…å®¹ (Rows = 100)</div>
                <div class="test-step">5. éªŒè¯æ¯ç§æƒ…å†µä¸‹çš„åˆ†é¡µæ˜¯å¦æ­£ç¡®</div>
            </div>
            <div class="expected-result">é¢„æœŸç»“æœ: 
                <ul>
                    <li>å°‘é‡å†…å®¹: æ˜¾ç¤º1é¡µï¼Œæ‰€æœ‰å†…å®¹åœ¨ä¸€é¡µå†…</li>
                    <li>ä¸´ç•Œå†…å®¹: æ˜¾ç¤º1-2é¡µï¼Œå†…å®¹åˆç†åˆ†é…</li>
                    <li>å¤§é‡å†…å®¹: æ˜¾ç¤º2-3é¡µï¼Œå†…å®¹è¿ç»­åˆ†å¸ƒ</li>
                    <li>è¶…å¤§é‡å†…å®¹: æ˜¾ç¤º3+é¡µï¼Œå†…å®¹è¿ç»­åˆ†å¸ƒ</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•åœºæ™¯ 5: å†…å®¹è¿ç»­æ€§éªŒè¯</div>
            <div class="test-steps">
                <div class="test-step">1. è®¾ç½® Table Rows Number ä¸º 20</div>
                <div class="test-step">2. è®°å½•ç¬¬ä¸€é¡µæ˜¾ç¤ºçš„tableè¡Œæ•°</div>
                <div class="test-step">3. è®°å½•ç¬¬äºŒé¡µæ˜¾ç¤ºçš„tableè¡Œæ•°</div>
                <div class="test-step">4. éªŒè¯ä¸¤é¡µçš„tableè¡Œæ•°ä¹‹å’Œæ˜¯å¦ç­‰äº20</li>
                <div class="test-step">5. éªŒè¯ç¬¬äºŒé¡µçš„è¡Œæ˜¯å¦ä»ç¬¬ä¸€é¡µç»“æŸçš„åœ°æ–¹å¼€å§‹</div>
            </div>
            <div class="expected-result">é¢„æœŸç»“æœ: 
                <ul>
                    <li>ç¬¬ä¸€é¡µæ˜¾ç¤ºçš„tableè¡Œæ•° + ç¬¬äºŒé¡µæ˜¾ç¤ºçš„tableè¡Œæ•° = 20</li>
                    <li>ç¬¬äºŒé¡µçš„tableè¡Œåº”è¯¥ä»ç¬¬ä¸€é¡µç»“æŸçš„åœ°æ–¹å¼€å§‹</li>
                    <li>ä¸åº”è¯¥æœ‰é‡å¤çš„tableè¡Œ</li>
                    <li>ä¸åº”è¯¥æœ‰é—æ¼çš„tableè¡Œ</li>
                </ul>
            </div>
        </div>

        <div class="fix-details">
            <h2>ğŸ“ ä¿®å¤æ€»ç»“</h2>
            <p><strong>ä¸»è¦æ”¹è¿›ï¼š</strong></p>
            <ol>
                <li><strong>æ™ºèƒ½å†…å®¹åˆ†é…</strong>ï¼šæ ¹æ®700pxé™åˆ¶æ™ºèƒ½åˆ†é…å†…å®¹åˆ°ä¸åŒé¡µé¢</li>
                <li><strong>è¡¨æ ¼è¡Œåˆ†é¡µ</strong>ï¼šè¡¨æ ¼è¡Œå¯ä»¥è·¨é¡µæ˜¾ç¤ºï¼Œé¿å…é‡å¤</li>
                <li><strong>ç²¾ç¡®é«˜åº¦è®¡ç®—</strong>ï¼šæ›´å‡†ç¡®çš„å†…å®¹é«˜åº¦è®¡ç®—å’Œåˆ†é¡µ</li>
                <li><strong>è¿ç»­æ€§ä¿è¯</strong>ï¼šç¡®ä¿å†…å®¹åœ¨é¡µé¢é—´è¿ç»­ï¼Œæ— é‡å¤æ— é—æ¼</li>
                <li><strong>Footerä½ç½®</strong>ï¼šFooteråªåœ¨æœ€åä¸€é¡µæ˜¾ç¤º</li>
            </ol>
            
            <p><strong>æŠ€æœ¯ç‰¹ç‚¹ï¼š</strong></p>
            <ul>
                <li>æ¯é¡µå†…å®¹é«˜åº¦æ§åˆ¶åœ¨700pxä»¥å†…</li>
                <li>è¡¨æ ¼è¡Œå¯ä»¥è·¨é¡µè¿ç»­æ˜¾ç¤º</li>
                <li>æ™ºèƒ½åˆ†é…å„éƒ¨åˆ†å†…å®¹åˆ°åˆé€‚é¡µé¢</li>
                <li>é¿å…å†…å®¹é‡å¤å’Œé—æ¼</li>
                <li>æ”¯æŒä»»æ„æ•°é‡çš„è¡¨æ ¼è¡Œ</li>
            </ul>
        </div>
    </div>
</body>
</html>









