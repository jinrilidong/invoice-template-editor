<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿ç»­åˆ†é¡µä¿®å¤æµ‹è¯• - Footerå’Œå†…å®¹é«˜åº¦åˆ†é¡µ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .test-steps {
            margin: 10px 0;
        }
        .test-step {
            margin: 5px 0;
            padding: 5px;
            background-color: #f5f5f5;
            border-radius: 3px;
        }
        .expected-result {
            color: #0066cc;
            font-weight: bold;
        }
        .debug-info {
            background-color: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .fix-details {
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .bug-fix {
            background-color: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .code-block {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>è¿ç»­åˆ†é¡µä¿®å¤æµ‹è¯• - Footerå’Œå†…å®¹é«˜åº¦åˆ†é¡µ</h1>
        
        <div class="bug-fix">
            <h2>ğŸ› ä¿®å¤çš„é—®é¢˜</h2>
            <ul>
                <li><strong>é—®é¢˜1</strong>ï¼šå¦‚æœæœ‰åˆ†é¡µï¼Œæ¯ä¸€é¡µé¡µè„šéƒ½åº”è¯¥æœ‰ footer sectionã€‚ç°åœ¨åªæœ‰æœ€åä¸€é¡µæœ‰ footerã€‚</li>
                <li><strong>é—®é¢˜2</strong>ï¼šæ¯ä¸€é¡µçš„å†…å®¹åŒºåŸŸé«˜åº¦æ˜¯700pxï¼Œè¶…å‡º700pxçš„å†…å®¹åˆ†åˆ°ä¸‹ä¸€é¡µæ˜¾ç¤ºã€‚</li>
                <li><strong>é—®é¢˜3</strong>ï¼šéœ€è¦æŒ‰ç…§å®é™…å†…å®¹é«˜åº¦è¿›è¡Œåˆ†é¡µï¼Œæ¯”å¦‚ABCDE5è¡Œå†…å®¹ï¼Œå½“é¡µé¢é«˜åº¦åªèƒ½æ˜¾ç¤ºABDæ—¶ï¼Œåˆ™æŠŠDEæ”¾åœ¨ä¸‹ä¸€é¡µã€‚</li>
            </ul>
        </div>

        <div class="fix-details">
            <h2>ğŸ”§ ä¿®å¤æ–¹æ¡ˆ</h2>
            
            <h3>1. å…ƒç´ åŒ–åˆ†é¡µç³»ç»Ÿ</h3>
            <div class="code-block">
// è·å–æ‰€æœ‰å†…å®¹å…ƒç´ åŠå…¶é«˜åº¦
const getAllContentElements = () => {
  const elements = []
  
  // Header: 48px
  if (props.sectionStates.header) {
    elements.push({ type: 'header', height: 48, content: 'header' })
  }
  
  // Info: 20px per item
  if (props.sectionStates.info) {
    elements.push({ type: 'info', height: items.length * 20, content: 'info' })
  }
  
  // Table Header: 40px
  elements.push({ type: 'table-header', height: 40, content: 'table-header' })
  
  // Table Rows: 15px per row
  allRows.forEach((row, index) => {
    elements.push({ type: 'table-row', height: 15, content: row, rowIndex: index })
  })
  
  // Description: 20px per 100 characters
  if (props.sectionStates.description) {
    elements.push({ type: 'description', height: Math.ceil(contentLength / 100) * 20, content: 'description' })
  }
  
  // Item: 20px per item
  if (props.sectionStates.item) {
    elements.push({ type: 'item', height: items.length * 20, content: 'item' })
  }
  
  return elements
}
            </div>
            
            <h3>2. è¿ç»­åˆ†é¡µé€»è¾‘</h3>
            <div class="code-block">
// è®¡ç®—æ¯é¡µåº”è¯¥æ˜¾ç¤ºçš„å†…å®¹
const getPageContent = (pageIndex: number) => {
  const maxHeightPerPage = 700
  const allElements = getAllContentElements()
  
  let currentHeight = 0
  let elementIndex = 0
  
  // è®¡ç®—å‰é¢é¡µé¢å·²ç»æ˜¾ç¤ºçš„å…ƒç´ 
  for (let i = 1; i < pageIndex; i++) {
    const prevPageElements = getPageElements(i)
    elementIndex += prevPageElements.length
  }
  
  // ä¸ºå½“å‰é¡µé¢åˆ†é…å…ƒç´ 
  while (elementIndex < allElements.length && currentHeight < maxHeightPerPage - 30) {
    const element = allElements[elementIndex]
    
    if (currentHeight + element.height <= maxHeightPerPage - 30) {
      // å¯ä»¥æ·»åŠ è¿™ä¸ªå…ƒç´ 
      currentHeight += element.height
      elementIndex++
    } else {
      // æ— æ³•æ·»åŠ è¿™ä¸ªå…ƒç´ ï¼Œåœæ­¢
      break
    }
  }
  
  // æ¯ä¸€é¡µéƒ½æ˜¾ç¤ºfooter
  if (props.sectionStates.footer) {
    pageContent.footer = true
  }
  
  return pageContent
}
            </div>
            
            <h3>3. ç²¾ç¡®é¡µæ•°è®¡ç®—</h3>
            <div class="code-block">
// åŸºäºå…ƒç´ é«˜åº¦è®¡ç®—æ€»é¡µæ•°
const totalPages = computed(() => {
  const maxHeightPerPage = 700
  const allElements = getAllContentElements()
  
  let currentPageHeight = 0
  let pages = 1
  
  for (const element of allElements) {
    // å¦‚æœæ·»åŠ è¿™ä¸ªå…ƒç´ ä¼šè¶…è¿‡é¡µé¢é«˜åº¦ï¼Œéœ€è¦æ–°é¡µé¢
    if (currentPageHeight + element.height > maxHeightPerPage - 30) {
      pages++
      currentPageHeight = element.height
    } else {
      currentPageHeight += element.height
    }
  }
  
  return Math.max(1, pages)
})
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•åœºæ™¯ 1: Footeræ¯é¡µæ˜¾ç¤º</div>
            <div class="test-steps">
                <div class="test-step">1. æ‰“å¼€åº”ç”¨ç¨‹åº (http://localhost:5174/)</div>
                <div class="test-step">2. è®¾ç½® Table Rows Number ä¸º 30</div>
                <div class="test-step">3. è§‚å¯Ÿç¬¬ä¸€é¡µçš„åº•éƒ¨</div>
                <div class="test-step">4. è§‚å¯Ÿç¬¬äºŒé¡µçš„åº•éƒ¨</div>
                <div class="test-step">5. è§‚å¯Ÿç¬¬ä¸‰é¡µçš„åº•éƒ¨ï¼ˆå¦‚æœæœ‰ï¼‰</div>
            </div>
            <div class="expected-result">é¢„æœŸç»“æœ: 
                <ul>
                    <li>ç¬¬ä¸€é¡µåº•éƒ¨åº”è¯¥æœ‰ footer section</li>
                    <li>ç¬¬äºŒé¡µåº•éƒ¨åº”è¯¥æœ‰ footer section</li>
                    <li>ç¬¬ä¸‰é¡µåº•éƒ¨åº”è¯¥æœ‰ footer section</li>
                    <li>æ¯ä¸€é¡µéƒ½åº”è¯¥æ˜¾ç¤º "Page: X of Y"</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•åœºæ™¯ 2: è¿ç»­å†…å®¹åˆ†é¡µ</div>
            <div class="test-steps">
                <div class="test-step">1. è®¾ç½® Table Rows Number ä¸º 20</div>
                <div class="test-step">2. è§‚å¯Ÿç¬¬ä¸€é¡µæ˜¾ç¤ºçš„tableè¡Œæ•°</div>
                <div class="test-step">3. è§‚å¯Ÿç¬¬äºŒé¡µæ˜¾ç¤ºçš„tableè¡Œæ•°</div>
                <div class="test-step">4. éªŒè¯ä¸¤é¡µçš„tableè¡Œæ•°ä¹‹å’Œæ˜¯å¦ç­‰äº20</div>
                <div class="test-step">5. éªŒè¯ç¬¬äºŒé¡µçš„è¡Œæ˜¯å¦ä»ç¬¬ä¸€é¡µç»“æŸçš„åœ°æ–¹å¼€å§‹</div>
            </div>
            <div class="expected-result">é¢„æœŸç»“æœ: 
                <ul>
                    <li>ç¬¬ä¸€é¡µæ˜¾ç¤ºçš„tableè¡Œæ•° + ç¬¬äºŒé¡µæ˜¾ç¤ºçš„tableè¡Œæ•° = 20</li>
                    <li>ç¬¬äºŒé¡µçš„tableè¡Œåº”è¯¥ä»ç¬¬ä¸€é¡µç»“æŸçš„åœ°æ–¹å¼€å§‹</li>
                    <li>ä¸åº”è¯¥æœ‰é‡å¤çš„tableè¡Œ</li>
                    <li>ä¸åº”è¯¥æœ‰é—æ¼çš„tableè¡Œ</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•åœºæ™¯ 3: å†…å®¹é«˜åº¦åˆ†é¡µ</div>
            <div class="test-steps">
                <div class="test-step">1. è®¾ç½® Table Rows Number ä¸º 50</div>
                <div class="test-step">2. è§‚å¯Ÿæ¯é¡µçš„å†…å®¹é«˜åº¦</div>
                <div class="test-step">3. æ£€æŸ¥æ¯é¡µå†…å®¹æ˜¯å¦æ¥è¿‘700px</div>
                <div class="test-step">4. éªŒè¯å†…å®¹æ˜¯å¦æŒ‰ç…§é«˜åº¦è¿ç»­åˆ†å¸ƒ</div>
                <div class="test-step">5. æ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹æº¢å‡º700px</div>
            </div>
            <div class="expected-result">é¢„æœŸç»“æœ: 
                <ul>
                    <li>æ¯é¡µå†…å®¹é«˜åº¦åº”è¯¥æ¥è¿‘700px</li>
                    <li>ä¸åº”è¯¥æœ‰å†…å®¹æº¢å‡º700px</li>
                    <li>å†…å®¹åº”è¯¥æŒ‰ç…§é«˜åº¦è¿ç»­åˆ†å¸ƒ</li>
                    <li>è¡¨æ ¼è¡Œå¯ä»¥è·¨é¡µæ˜¾ç¤º</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•åœºæ™¯ 4: ABCDåˆ†é¡µç¤ºä¾‹</div>
            <div class="test-steps">
                <div class="test-step">1. è®¾ç½® Table Rows Number ä¸º 5</div>
                <div class="test-step">2. è§‚å¯Ÿç¬¬ä¸€é¡µæ˜¾ç¤ºçš„å†…å®¹ï¼ˆå‡è®¾æ˜¾ç¤ºAã€Bã€Cï¼‰</div>
                <div class="test-step">3. è§‚å¯Ÿç¬¬äºŒé¡µæ˜¾ç¤ºçš„å†…å®¹ï¼ˆåº”è¯¥æ˜¾ç¤ºDã€Eï¼‰</div>
                <div class="test-step">4. éªŒè¯å†…å®¹æ˜¯å¦æŒ‰ç…§ABCDEé¡ºåºè¿ç»­åˆ†å¸ƒ</div>
                <div class="test-step">5. éªŒè¯æ¯é¡µéƒ½æœ‰footer</div>
            </div>
            <div class="expected-result">é¢„æœŸç»“æœ: 
                <ul>
                    <li>ç¬¬ä¸€é¡µï¼šæ˜¾ç¤ºAã€Bã€Cï¼ˆå¦‚æœé«˜åº¦å…è®¸ï¼‰</li>
                    <li>ç¬¬äºŒé¡µï¼šæ˜¾ç¤ºDã€Eï¼ˆå‰©ä½™å†…å®¹ï¼‰</li>
                    <li>å†…å®¹æŒ‰ç…§ABCDEé¡ºåºè¿ç»­åˆ†å¸ƒ</li>
                    <li>æ¯é¡µéƒ½æœ‰footer section</li>
                </ul>
            </div>
        </div>

        <div class="debug-info">
            <h3>ğŸ› è°ƒè¯•ä¿¡æ¯æ£€æŸ¥</h3>
            <p>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Console æ ‡ç­¾ï¼Œåº”è¯¥çœ‹åˆ°ï¼š</p>
            
            <h4>1. å…ƒç´ åˆ†é¡µä¿¡æ¯</h4>
            <div class="code-block">
PdfPreviewPanel: Total pages calculation {
  totalElements: 25,        // æ€»å…ƒç´ æ•°é‡
  maxHeightPerPage: 700,    // æ¯é¡µæœ€å¤§é«˜åº¦
  calculatedPages: 3,       // è®¡ç®—çš„é¡µæ•°
  elements: [               // æ‰€æœ‰å…ƒç´ 
    { type: 'header', height: 48 },
    { type: 'info', height: 60 },
    { type: 'table-header', height: 40 },
    { type: 'table-row', height: 15 },
    { type: 'table-row', height: 15 },
    // ... æ›´å¤šå…ƒç´ 
  ]
}
            </div>
            
            <h4>2. è¡¨æ ¼æ•°æ®æ›´æ–°</h4>
            <div class="code-block">
PdfPreviewPanel: table data updated [{
  id: "table-1",
  rowsNumber: 20,           // è®¾ç½®çš„è¡Œæ•°
  baseRowsCount: 5,         // åŸºç¡€è¡Œæ•°
  actualRowsToShow: 20      // å®é™…æ˜¾ç¤ºçš„è¡Œæ•°
}]
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•åœºæ™¯ 5: è¾¹ç•Œæƒ…å†µæµ‹è¯•</div>
            <div class="test-steps">
                <div class="test-step">1. æµ‹è¯•å°‘é‡å†…å®¹ (Rows = 3)</div>
                <div class="test-step">2. æµ‹è¯•ä¸´ç•Œå†…å®¹ (Rows = 10)</div>
                <div class="test-step">3. æµ‹è¯•å¤§é‡å†…å®¹ (Rows = 30)</div>
                <div class="test-step">4. æµ‹è¯•è¶…å¤§é‡å†…å®¹ (Rows = 100)</div>
                <div class="test-step">5. éªŒè¯æ¯ç§æƒ…å†µä¸‹çš„åˆ†é¡µå’Œfooter</div>
            </div>
            <div class="expected-result">é¢„æœŸç»“æœ: 
                <ul>
                    <li>å°‘é‡å†…å®¹: æ˜¾ç¤º1é¡µï¼Œæœ‰footer</li>
                    <li>ä¸´ç•Œå†…å®¹: æ˜¾ç¤º1-2é¡µï¼Œæ¯é¡µéƒ½æœ‰footer</li>
                    <li>å¤§é‡å†…å®¹: æ˜¾ç¤º2-3é¡µï¼Œæ¯é¡µéƒ½æœ‰footer</li>
                    <li>è¶…å¤§é‡å†…å®¹: æ˜¾ç¤º3+é¡µï¼Œæ¯é¡µéƒ½æœ‰footer</li>
                </ul>
            </div>
        </div>

        <div class="fix-details">
            <h2>ğŸ“ ä¿®å¤æ€»ç»“</h2>
            <p><strong>ä¸»è¦æ”¹è¿›ï¼š</strong></p>
            <ol>
                <li><strong>Footeræ¯é¡µæ˜¾ç¤º</strong>ï¼šæ¯ä¸€é¡µéƒ½æœ‰footer sectionï¼Œä¸åªæ˜¯æœ€åä¸€é¡µ</li>
                <li><strong>å…ƒç´ åŒ–åˆ†é¡µ</strong>ï¼šå°†å†…å®¹åˆ†è§£ä¸ºå…ƒç´ ï¼ŒæŒ‰é«˜åº¦è¿›è¡Œåˆ†é¡µ</li>
                <li><strong>è¿ç»­å†…å®¹åˆ†é¡µ</strong>ï¼šå†…å®¹æŒ‰ç…§ABCDEé¡ºåºè¿ç»­åˆ†å¸ƒåˆ°ä¸åŒé¡µé¢</li>
                <li><strong>ç²¾ç¡®é«˜åº¦æ§åˆ¶</strong>ï¼šæ¯é¡µå†…å®¹é«˜åº¦æ§åˆ¶åœ¨700pxä»¥å†…</li>
                <li><strong>è¡¨æ ¼è¡Œè·¨é¡µ</strong>ï¼šè¡¨æ ¼è¡Œå¯ä»¥è·¨é¡µæ˜¾ç¤ºï¼Œä¿æŒè¿ç»­æ€§</li>
            </ol>
            
            <p><strong>æŠ€æœ¯ç‰¹ç‚¹ï¼š</strong></p>
            <ul>
                <li>æ¯é¡µå†…å®¹é«˜åº¦æ§åˆ¶åœ¨700pxä»¥å†…</li>
                <li>æ¯ä¸€é¡µéƒ½æœ‰footer section</li>
                <li>å†…å®¹æŒ‰ç…§é«˜åº¦è¿ç»­åˆ†å¸ƒ</li>
                <li>è¡¨æ ¼è¡Œå¯ä»¥è·¨é¡µæ˜¾ç¤º</li>
                <li>æ”¯æŒä»»æ„æ•°é‡çš„å†…å®¹å…ƒç´ </li>
            </ul>
        </div>
    </div>
</body>
</html>









